name: Otomatik Analytics Ekle
on:
  push:
    branches: [ main ] # veya master

jobs:
  add-analytics:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout kodları
        uses: actions/checkout@v3

      - name: Python ile kodları enjekte et
        run: |
          python -c '
          import os
          ga_code = """<script async src="https://www.googletagmanager.com/gtag/js?id=G-QL7NLR92NW"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag("js", new Date());gtag("config", "G-QL7NLR92NW");</script>"""
          for root, dirs, files in os.walk("."):
              for file in files:
                  if file.endswith(".html"):
                      path = os.path.join(root, file)
                      with open(path, "r", encoding="utf-8") as f:
                          content = f.read()
                      if "G-QL7NLR92NW" not in content:
                          new_content = content.replace("<head>", "<head>\n" + ga_code)
                          with open(path, "w", encoding="utf-8") as f:
                              f.write(new_content)
          '
      - name: Değişiklikleri Kaydet ve Yayınla
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add .
          git commit -m "Otomatik Analytics kodu eklendi" || echo "Değişiklik yok"
          git push
